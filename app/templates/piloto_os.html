{% extends "base.html" %}
{% block content %}
<div class="container py-4">

  <div class="d-flex flex-wrap justify-content-between align-items-center gap-2 mb-3">
    <div>
      <h3 class="fw-bold m-0">Ordens de Serviço</h3>
      <div class="text-muted small">
        Exibindo: <b>APROVADO</b> e <b>APROVADO COM RECOMENDAÇÕES</b>
      </div>
    </div>

    <div class="d-flex gap-2">
      <a class="btn btn-outline-secondary" href="{{ url_for('main.dashboard') }}">
        Voltar
      </a>
    </div>
  </div>

  {% if pedidos|length == 0 %}
    <div class="alert alert-info">
      Nenhuma ordem de serviço liberada para você no momento.
    </div>
  {% else %}
    <div class="table-responsive">
      <table class="table table-hover align-middle">
        <thead>
          <tr>
            <th>Data</th>
            <th>Hora</th>
            <th>UVIS</th>
            <th>Região</th>
            <th>Bairro</th>
            <th>Status</th>
            <th class="text-end">Detalhes</th>
          </tr>
        </thead>
        <tbody>
          {% for s in pedidos %}
          <tr>
            <td>{{ s.data_agendamento|datetimeformat("%d/%m/%Y") }}</td>

            {# hora pode ser time() ou string #}
            <td>
              {% if s.hora_agendamento %}
                {{ s.hora_agendamento.strftime("%H:%M") if s.hora_agendamento.strftime else s.hora_agendamento }}
              {% else %}
                -
              {% endif %}
            </td>

            <td>{{ s.usuario.nome_uvis if s.usuario else "-" }}</td>
            <td>{{ s.usuario.regiao if s.usuario else "-" }}</td>
            <td>{{ s.bairro or "-" }}</td>


            <td class="text-end">
              {# ✅ endpoint correto: piloto_ver_os #}
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    <!-- paginação -->
    <nav class="mt-3">
      <ul class="pagination">
        {% if paginacao.has_prev %}
          <li class="page-item">
            <a class="page-link" href="{{ url_for('main.piloto_os', page=paginacao.prev_num) }}">Anterior</a>
          </li>
        {% else %}
          <li class="page-item disabled"><span class="page-link">Anterior</span></li>
        {% endif %}

        <li class="page-item disabled">
          <span class="page-link">Página {{ paginacao.page }} de {{ paginacao.pages }}</span>
        </li>

        {% if paginacao.has_next %}
          <li class="page-item">
            <a class="page-link" href="{{ url_for('main.piloto_os', page=paginacao.next_num) }}">Próxima</a>
          </li>
        {% else %}
          <li class="page-item disabled"><span class="page-link">Próxima</span></li>
        {% endif %}
      </ul>
    </nav>
  {% endif %}

</div>
{% endblock %}
