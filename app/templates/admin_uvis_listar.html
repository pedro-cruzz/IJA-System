{% extends "base.html" %} {% block content %}

<div class="container-fluid py-4" style="max-width: 1200px">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h2 class="text-dark">
      <i class="bi bi-buildings-fill me-2 text-primary"></i> UVIS Cadastradas
    </h2>

    <div class="d-flex gap-2">
      <a
        href="{{ url_for('main.admin_dashboard') }}"
        class="btn btn-outline-secondary d-flex align-items-center gap-2"
      >
        <i class="bi bi-arrow-left"></i> Voltar
      </a>
      <a
        href="{{ url_for('main.admin_uvis_exportar', q=q, regiao=regiao, codigo_setor=codigo_setor) }}"
        class="btn btn-outline-primary d-flex align-items-center gap-2"
      >
        <i class="bi bi-file-earmark-excel"></i> Exportar Excel
      </a>
      <a
        href="{{ url_for('main.admin_uvis_novo') }}"
        class="btn btn-success text-white d-flex align-items-center gap-2 shadow-sm"
      >
        <i class="bi bi-plus-lg"></i> Nova UVIS
      </a>
    </div>
  </div>

  <form method="GET" class="card p-3 mb-4 shadow-sm rounded-4">
    <div class="row g-2 align-items-end">
      <div class="col-md-4">
        <label for="search_q" class="small text-muted"
          >Buscar (nome ou login):</label
        >
        <input
          type="text"
          class="form-control form-control-sm"
          name="q"
          id="search_q"
          value="{{ q }}"
          placeholder="Ex: UVIS Centro"
        />
      </div>

      <div class="col-md-3">
        <label for="search_regiao" class="small text-muted">Região:</label>
        <input
          type="text"
          class="form-control form-control-sm"
          name="regiao"
          id="search_regiao"
          value="{{ regiao }}"
          placeholder="Ex: Norte"
        />
      </div>

      <div class="col-md-2">
        <label for="search_codigo" class="small text-muted">Cód. Setor:</label>
        <input
          type="text"
          class="form-control form-control-sm"
          name="codigo_setor"
          id="search_codigo"
          value="{{ codigo_setor }}"
          placeholder="Ex: 123A"
        />
      </div>

      <div class="col-md-3 d-flex gap-2">
        <button type="submit" class="btn btn-success btn-sm w-100">
          <i class="bi bi-funnel"></i> Filtrar
        </button>

        {% if q or regiao or codigo_setor %}
        <a
          href="{{ url_for(request.endpoint) }}"
          class="btn btn-outline-secondary btn-sm w-100"
        >
          <i class="bi bi-x-lg"></i> Limpar
        </a>
        {% endif %}
      </div>
    </div>
  </form>

  <div class="card shadow-sm">
    <div class="card-body p-0">
      <div class="table-responsive">
        <table class="table table-hover align-middle mb-0">
          <thead class="table-light">
            <tr>
              <th style="width: 80px">ID</th>
              <th>Nome</th>
              <th>Região</th>
              <th>Cód. Setor</th>
              <th>Login</th>
              <th style="width: 160px">Ações</th>
            </tr>
          </thead>
          <tbody>
            {% if uvis and uvis|length > 0 %} {% for u in uvis %}
            <tr>
              <td class="text-muted">{{ u.id }}</td>
              <td class="fw-semibold">{{ u.nome_uvis }}</td>
              <td>{{ u.regiao or "-" }}</td>
              <td>{{ u.codigo_setor or "-" }}</td>
              <td><code>{{ u.login }}</code></td>
              <td>
                <div class="d-flex gap-2">
                  <a
                    class="btn btn-sm btn-success"
                    href="{{ url_for('main.admin_uvis_editar', id=u.id) }}"
                  >
                    <i class="bi bi-pencil-square me-1"></i>Editar
                  </a>

                  <form
                    class="form-deletar"
                    method="POST"
                    action="{{ url_for('main.admin_uvis_excluir', id=u.id) }}"
                  >
                    <button type="submit" class="btn btn-sm btn-danger">
                      <i class="bi bi-trash me-1"></i>Excluir
                    </button>
                  </form>
                </div>
              </td>
            </tr>
            {% endfor %} {% else %}
            <tr>
              <td colspan="5" class="text-center py-4 text-muted">
                Nenhuma UVIS encontrada.
              </td>
            </tr>
            {% endif %}
          </tbody>
        </table>
      </div>
    </div>

    {% if paginacao.pages > 1 %}
    <div class="card-footer bg-transparent">
      <nav>
        <ul class="pagination mb-0 flex-wrap">
          <li
            class="page-item {% if not paginacao.has_prev %}disabled{% endif %}"
          >
            <a
              class="page-link"
              href="{{ url_for('main.admin_uvis_listar', page=paginacao.prev_num, q=q, regiao=regiao, codigo_setor=codigo_setor) }}"
            >
              Anterior
            </a>
          </li>

          {% for p in range(1, paginacao.pages + 1) %}
          <li class="page-item {% if p == paginacao.page %}active{% endif %}">
            <a
              class="page-link"
              href="{{ url_for('main.admin_uvis_listar', page=p, q=q, regiao=regiao, codigo_setor=codigo_setor) }}"
            >
              {{ p }}
            </a>
          </li>
          {% endfor %}

          <li
            class="page-item {% if not paginacao.has_next %}disabled{% endif %}"
          >
            <a
              class="page-link"
              href="{{ url_for('main.admin_uvis_listar', page=paginacao.next_num, q=q, regiao=regiao, codigo_setor=codigo_setor) }}"
            >
              Próxima
            </a>
          </li>
        </ul>
      </nav>
    </div>
    {% endif %}
  </div>
</div>
{% endblock %}
